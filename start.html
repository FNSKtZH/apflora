<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>AP Flora Kt ZH</title>
	</head>
	<body style="background-color: #FFE; height:100%">
		<script type="text/javascript" src="src/jquery.js"></script>
		<script type="text/javascript" src="src/jquery.jstree.js"></script>
		<script type="text/javascript" src="src/jquery.cookie.js"></script>
		<script type="text/javascript" src="src/jquery.hotkeys.js"></script>
		<link rel="stylesheet" href="style/apflora.css" type="text/css"/>
		<script>
			$(document).ready(function () {
				//Suche steuern
				$("body").on("keyup click", "#suchen", function () {
					if (this.value.length > 2) {
						$("#tree").jstree("search", this.value);
					} else {
						$("#tree").jstree("clear_search");
					}
				});
				$("#tree").jstree( {
					"json_data": {
						"ajax": {
							"url": "php/tree.php",
							//"progressive_render": true,
							"data" : function (n) {
								return {
									id : n.attr ? n.attr("id") : 0,
									typ : n.attr ? n.attr("typ") : 0
								};
							}
						}
					},
					"core": {
						"open_parents": true,	//wird ein node programmatisch geöffnet, öffnen sich alle parents
						"strings": {	//Deutsche Übersetzungen
							loading: "hole Daten...",
							new_node: "neuer Knoten"
						},
					},
					"ui": {
						"select_limit": 1,	//nur ein Datensatz kann aufs mal gewählt werden
						"selected_parent_open": true	//wenn Code einen node wählt, werden alle parents geöffnet
					},
					"search": {
						"case_insensitive": true
					},
					"themes": {
						"icons": false
					},
					"types": {
						"default": {
							"select_node": function(e) {
								this.correct_state(e);
								this.toggle_node(e);
								return false;
							}
						}
					},
					"plugins" : ["themes", "json_data", "ui", "hotkeys", "search", "types"]
				})
				.bind("open_node.jstree", function (e, data) {
					var node = data.rslt.obj;
					//this.open_node(e);
					// `data.rslt.obj` is the jquery extended node that was clicked
					//alert(data.rslt.obj.attr("typ") + " mit id " + data.rslt.obj.attr("id"));
					if (node.attr("typ") === "ap") {
						$.ajax({
							type: "GET",
							url: "php/test.php",
							data: {
								"id": node.attr("id"),
								"typ": node.attr("typ")
							},
							success: function (data) {
								jQuery.jstree._reference(node).create_node(node, "last", JSON.stringify(data));
							}
						});
					}
					//open_node	soll auch durch click auf node ausgelöst werden
					//HIER ID UND TYP ÜBERNEHMEN
					//JE NACH TYP DB ABFRAGEN (POST AN PHP)
					//DANN MIT DB-ANTWORT NODES AUFBAUEN MIT create_node gemäss http://www.jstree.com/documentation/core#
					//DANN MIT set_focus FOCUS AUF DEN ERSTEN NODE UND DIESEN ALS DATENSATZ IN FORM ANZEIGEN
					//mit mysql_num_rows() anzahl Zeilen zählen
				});
			});
		</script>
		<div id="menu" style="width:300px; float:left; padding-right:5px; background-color:#FFE; border:1px solid; border-color:#A5A59A;">
			<input type="search" id="suchen" placeholder="suchen" style="background-color:#FFFFF7;"/>
			<div id="tree"></div>
		</div>
		<div id="form" style="display:block; margin-left:auto; padding-left:320px; padding-top:1px;">
			<p>hier soll der Inhalt kommen</p>
		</div>
	</body>
</html>