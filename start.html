<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<script type="text/javascript" src="src/jquery.js"></script>
		<script type="text/javascript" src="src/jquery.jstree.js"></script>
		<script type="text/javascript" src="src/jquery.cookie.js"></script>
		<script type="text/javascript" src="src/jquery.hotkeys.js"></script>
		<script type="text/javascript" src="src/apflora.js"></script>
		<link rel="stylesheet" href="style/apflora.css" type="text/css"/>
		<title>AP Flora Kt ZH</title>
	</head>
	<body style="background-color: #FFE; height:100%">
		<div id="menu" style="width:350px; float:left; padding-right:5px; background-color:#FFE; border:1px solid; border-color:#A5A59A;">
			<div data-role='fieldcontain' style="margin-top:3px;">
				<label id="ap_waehlen_label" for='ap_waehlen' class='select' style="margin-left:6px;margin-top:3px;">Art w√§hlen:</label>
				<select id="ap_waehlen" style="width:344px; margin-left:5px; margin-top:2px;">
					<option></option>
				</select>
			</div>
			<div data-role='fieldcontain' style="margin-top:3px; margin-bottom:3px;">
				<input type="button" id="ap_arten" value="AP-Arten" style="float:left; margin-left:5px; height:26px;">
				<input type="search" id="suchen" placeholder="suchen" style="background-color:#FFFFF7; margin-left:5px; visibility:hidden;"/>
			</div>
			<div id="tree" style="width:330px; margin-bottom:5px;"></div>
		</div>
		<form id="ap_form" style=" visibility:hidden; display:block; margin-left:auto; padding-left:390px; padding-top:1px;" action="#" method="get" autocomplete="off">
			<div data-role='fieldcontain' style="margin-top:6px;">
				<label id="ApArtId_label" for='ApArtId' style="">Art:</label>
				<select id="ApArtId" style="width:344px; margin-left:106px; margin-top:2px;">
					<option></option>
				</select>
			</div>
			<div data-role='fieldcontain' style="margin-top:10px;">
				<label id="ApStatus_label" for='ApStatus' style="">Aktionsplan:</label>
				<input type="radio" name="ApStatus" id="0" value="0" style="margin-left:45px;" />(kein Eintrag)<br />
				<input type="radio" name="ApStatus" id="4" value="4" style="margin-left:134px;" />keiner<br />
				<input type="radio" name="ApStatus" id="1" value="1" style="margin-left:134px;" />vorgesehen<br />
				<input type="radio" name="ApStatus" id="2" value="2" style="margin-left:134px;" />in Bearbeitung<br />
				<input type="radio" name="ApStatus" id="3" value="3" style="margin-left:134px;" />erstellt
			</div>
			<div data-role='fieldcontain' style="margin-top:10px;">
				<label id="ApJahr_label" for='ApJahr' style="">Start im Jahr:</label>
				<input id="ApJahr" type="number" style="width:344px; margin-left:38px; margin-top:2px;">
				</select>
			</div>
			<div data-role='fieldcontain' style="margin-top:10px;">
				<label id="ApUmsetzung_label" for='ApUmsetzung' style="">Stand Umsetzung:</label>
				<input type="radio" name="ApUmsetzung" id="0" value="0" style="margin-left:4px;" />noch keine Umsetzung<br />
				<input type="radio" name="ApUmsetzung" id="1" value="1" style="margin-left:134px;" />in Umsetzung<br />
				<input type="radio" name="ApUmsetzung" id="2" value="2" style="margin-left:134px;" />umgesetzt
			</div>
		</form>
		<script>
			$(document).ready(function () {
				erstelle_ap_liste();
				erstelle_ApArtId_liste();

				$("#menu").on("click", "#ap_arten", function () {

					if ($(this).val() === "AP-Arten") {
						$(this).val("alle Arten");
						erstelle_ap_liste("ap_arten");
					} else {
						$(this).val("AP-Arten");
						erstelle_ap_liste();
					}
					$('#tree').empty();
					$("#ap_waehlen_label").show();
					ap_sichtbarkeit_setzen();
				});

				$("#menu").on("change", "#ap_waehlen", function () {
					$("#suchen").css('visibility', 'visible');
					$("#ap_waehlen_label").hide();
					erstelle_tree(this.value);
					ap_sichtbarkeit_setzen();
				});

				//Suche steuern
				$("body").on("keyup click", "#suchen", function () {
					if (this.value.length > 2) {
						$("#tree").jstree("search", this.value);
					} else {
						$("#tree").jstree("clear_search");
					}
				});
				
			});

			function ap_sichtbarkeit_setzen() {
				if ($("#ap_waehlen").val()) {
					$("#ap_form").css("visibility", "visible");
				} else {
					$("#ap_form").css("visibility", "hidden");
				}
			}

			function erstelle_ApArtId_liste() {
				$.ajax({
					url: 'php/artliste.php',
					dataType: 'json',
					success: function (data) {
						var html;
						html = "<option></option>";
						for (i in data.rows) {
							if (typeof i !== "undefined") {
								html += "<option value=\"" + data.rows[i].id + "\">" + data.rows[i].Artname + "</option>";
							}
						}
						$("#ApArtId").html(html);
					}
				});
			}
		</script>
	</body>
</html>